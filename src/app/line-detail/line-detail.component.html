<header>{{ this.line.label }}線 ＜{{ this.line.section }}＞</header>
<ul class="trains">
  @for (train of trains; track train) {
    <li class="train">
      <mat-icon>train</mat-icon>
      <div class="train-rows">
        <!-- 列車番号 -->
        <span class="train-no">{{ train.trainNo }}</span>
        <!-- 種別・愛称・行先・両数 -->
        <div class="train-summary">
          @if (
            train.trainDisplayType != "寝台" &&
            train.trainDisplayType != "A新快○" &&
            train.trainDisplayType != "A新快×" &&
            train.trainDisplayType != "大和路快" &&
            train.trainDisplayType != "みやこ快" &&
            train.trainDisplayType != "関空紀州" &&
            train.trainDisplayType != "紀州路快" &&
            train.trainDisplayType != "丹波路快" &&
            train.trainDisplayType != "う快速○" &&
            train.trainDisplayType != "う快速×" &&
            train.trainDisplayType != "う直快○" &&
            train.trainDisplayType != "う直快×"
          ) {
            <span
              [ngClass]="{
                express: train.trainDisplayType.match('特急'),
                sleeper: train.trainDisplayType == '寝台',
                's-rapid': train.trainDisplayType.match('新快'),
                rapid: train.trainDisplayType == '快速',
                regional: train.trainDisplayType == '区間快速',
                yamatoji: train.trainDisplayType == '大和路快',
                miyakoji: train.trainDisplayType == 'みやこ路快速',
                kixkishu: train.trainDisplayType == '関空紀州',
                kix: train.trainDisplayType == '関空快速',
                kishu: train.trainDisplayType == '紀州路快',
                tambaji: train.trainDisplayType.match('丹波路快'),
                direct: train.trainDisplayType == '直通快速',
              }"
              class="type"
            >
              {{ train.trainDisplayType }}
            </span>
          }
          @if (train.trainDisplayType.match("寝台")) {
            <span
              [ngClass]="{ sleeper: train.trainDisplayType == '寝台' }"
              class="type"
              >寝台特急</span
            >
          }
          @if (train.trainDisplayType.match("A新快")) {
            <span
              [ngClass]="{ 's-rapid': train.trainDisplayType.match('新快') }"
              class="type"
              >新快速</span
            >
          }
          @if (train.trainDisplayType == "大和路快") {
            <span
              [ngClass]="{ yamatoji: train.trainDisplayType == '大和路快' }"
              class="type"
              >大和路快速</span
            >
          }
          @if (train.trainDisplayType == "みやこ快") {
            <span
              [ngClass]="{ miyakoji: train.trainDisplayType == 'みやこ快' }"
              class="type"
              >みやこ路快速</span
            >
          }
          @if (train.trainDisplayType == "関空紀州") {
            <span
              [ngClass]="{ kixkishu: train.trainDisplayType == '関空紀州' }"
              class="type"
              >関空/紀州路快速</span
            >
          }
          @if (train.trainDisplayType == "紀州路快") {
            <span
              [ngClass]="{ kishu: train.trainDisplayType == '紀州路快' }"
              class="type"
              >紀州路快速</span
            >
          }
          @if (train.trainDisplayType == "丹波路快") {
            <span
              [ngClass]="{ tambaji: train.trainDisplayType == '丹波路快' }"
              class="type"
              >丹波路快速</span
            >
          }
          @if (train.trainDisplayType.match("う快速")) {
            <span
              [ngClass]="{ rapid: train.trainDisplayType.match('う快') }"
              class="type"
              >快速</span
            >
          }
          @if (train.trainDisplayType.match("う直快")) {
            <span
              [ngClass]="{ direct: train.trainDisplayType.match('う直') }"
              class="type"
              >直通快速</span
            >
          }

          @if (train.trainNickname) {
            <span>
              {{ train.trainNickname }}
            </span>
          }
          |
          @if (train.trainDest) {
            @if (train.trainVia) {
              <span> {{ train.trainVia }}経由・{{ train.trainDest }} </span>
            }
            @if (!train.trainVia) {
              <span>
                {{ train.trainDest }}
              </span>
            }
          }
          @if (train.trainCars) {
            <span>({{ train.trainCars }}両)</span>
          }
        </div>

        <!-- 走行位置・遅れ時分 -->
        <div class="position-and-delay">
          <!-- 走行位置 -->
          {{ train.trainPos }}

          <!-- 上り/下り -->
          @if (train.trainDirectionUp == true) {
            <span class="up-down">上り </span>
          } @else if (train.trainDirectionUp == false) {
            <span class="up-down">下り </span>
          }

          <!-- 遅れ -->
          @if (train.trainDelayMinutes == 61) {
            <span class="over-delay">(1時間以上遅れ) </span>
          }
          @if (train.trainDelayMinutes >= 1 && train.trainDelayMinutes < 61) {
            <span class="delay">({{ train.trainDelayMinutes }}分遅れ) </span>
          }
          @if (train.trainDelayMinutes == 0) {
            <span>(定刻) </span>
          }
        </div>

        <!-- 備考欄 -->
        @if (train.trainNotices && train.trainNotices.length >= 1) {
          <div matListItemLine>
            備考：
            @for (notice of train.trainNotices; track $index) {
              {{ notice }}
              @if ($index != 0) {
                /
              }
            }
          </div>
        }
      </div>
    </li>
  }
</ul>

<div class="fabs">
  <button
    class="notice-register-button"
    routerLink="/notice"
    [queryParams]="{ line: line.linename }"
    mat-fab
    color="primary"
  >
    <mat-icon>notifications</mat-icon>
  </button>

  <button
    class="station-list-button"
    routerLink="/stations/{{ line.linename }}"
    mat-fab
    color="primary"
  >
    <mat-icon>other_houses</mat-icon>
  </button>

  <button
    class="refresh-button"
    (click)="this.loadTrains()"
    mat-fab
    color="primary"
  >
    <mat-icon>refresh</mat-icon>
  </button>
</div>
